<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Injector - Test Redirect Functionality</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #218838; }
        .config { background: #e9ecef; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        label { display: block; margin: 10px 0; }
        input[type="checkbox"] { margin-right: 8px; }
    </style>
</head>
<body>
    <h1>üö® Incident Injector Redirect Test</h1>
    
    <div class="config">
        <h3>Configuration</h3>
        <label>
            <input type="checkbox" id="showAlert" checked> Show alert popup
        </label>
        <label>
            <input type="checkbox" id="redirectTo500" checked> Redirect to 500 error page
        </label>
        <label>
            <input type="checkbox" id="allowFormContinuation"> Allow form submission after alert
        </label>
    </div>

    <div class="form-container">
        <h3>üìù Test Form</h3>
        <form id="testForm">
            <p>
                <label>Name: <input type="text" name="name" required></label>
            </p>
            <p>
                <label>Email: <input type="email" name="email" required></label>
            </p>
            <p>
                <button type="submit">Submit Form</button>
            </p>
        </form>
    </div>

    <div class="form-container">
        <h3>üîò Test Button</h3>
        <button id="testButton">Click Me</button>
    </div>

    <script>
        // Configuration variables
        let showAlert = true;
        let redirectTo500 = true;
        let allowFormContinuation = false;

        // Update configuration based on checkboxes
        function updateConfig() {
            showAlert = document.getElementById('showAlert').checked;
            redirectTo500 = document.getElementById('redirectTo500').checked;
            allowFormContinuation = document.getElementById('allowFormContinuation').checked;
            console.log('Config updated:', { showAlert, redirectTo500, allowFormContinuation });
        }

        // Add event listeners to checkboxes
        document.getElementById('showAlert').addEventListener('change', updateConfig);
        document.getElementById('redirectTo500').addEventListener('change', updateConfig);
        document.getElementById('allowFormContinuation').addEventListener('change', updateConfig);

        // Simulate the extension's handleElementIncident function
        function handleElementIncident(element, event) {
            console.log('[PagerDuty Simulator] Element clicked:', element.textContent || element.type);
            
            // Prevent default action
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            // Show alert if enabled
            if (showAlert) {
                alert('üö® Incident Injected!\n\nA server error has been triggered.\nIncident details have been sent to PagerDuty.');
            }

            // Handle post-alert actions
            const delay = showAlert ? 1000 : 100;
            setTimeout(() => {
                console.log('[PagerDuty Simulator] Post-alert actions - redirectTo500:', redirectTo500, 'allowFormContinuation:', allowFormContinuation);
                
                if (redirectTo500) {
                    // Redirect to a 500 error page
                    console.log('[PagerDuty Simulator] Redirecting to 500 error page...');
                    try {
                        // Simple approach - redirect to a basic error page
                        document.open();
                        document.write(`
                            <html>
                                <head>
                                    <title>500 Internal Server Error</title>
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <style>
                                        * { margin: 0; padding: 0; box-sizing: border-box; }
                                        body {
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                            min-height: 100vh;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            color: #333;
                                        }
                                        .error-container {
                                            background: rgba(255, 255, 255, 0.95);
                                            backdrop-filter: blur(10px);
                                            border-radius: 20px;
                                            padding: 60px 40px;
                                            text-align: center;
                                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                                            max-width: 600px;
                                            width: 90%;
                                            border: 1px solid rgba(255, 255, 255, 0.2);
                                        }
                                        .error-icon {
                                            font-size: 80px;
                                            margin-bottom: 20px;
                                            color: #ff6b6b;
                                            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                                        }
                                        .error-code {
                                            font-size: 120px;
                                            font-weight: 800;
                                            color: #ff6b6b;
                                            margin-bottom: 10px;
                                            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                                            letter-spacing: -2px;
                                        }
                                        h1 {
                                            font-size: 32px;
                                            color: #2c3e50;
                                            margin-bottom: 20px;
                                            font-weight: 600;
                                        }
                                        .error-message {
                                            font-size: 18px;
                                            color: #7f8c8d;
                                            margin-bottom: 30px;
                                            line-height: 1.6;
                                        }
                                        .status-box {
                                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                                            color: white;
                                            padding: 20px;
                                            border-radius: 12px;
                                            margin: 30px 0;
                                            font-weight: 500;
                                            box-shadow: 0 8px 16px rgba(79, 172, 254, 0.3);
                                        }
                                        .status-icon {
                                            font-size: 24px;
                                            margin-right: 10px;
                                            vertical-align: middle;
                                        }
                                        .details {
                                            background: #f8f9fa;
                                            border-radius: 12px;
                                            padding: 25px;
                                            margin: 25px 0;
                                            text-align: left;
                                            border-left: 4px solid #ff6b6b;
                                        }
                                        .details h3 {
                                            color: #2c3e50;
                                            margin-bottom: 15px;
                                            font-size: 18px;
                                        }
                                        .details p {
                                            margin: 8px 0;
                                            color: #5a6c7d;
                                            font-size: 14px;
                                        }
                                        .details strong {
                                            color: #2c3e50;
                                            font-weight: 600;
                                        }
                                        .timestamp {
                                            color: #95a5a6;
                                            font-family: 'Monaco', 'Menlo', monospace;
                                            font-size: 12px;
                                        }
                                        .back-button {
                                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                            color: white;
                                            border: none;
                                            padding: 15px 30px;
                                            border-radius: 25px;
                                            font-size: 16px;
                                            font-weight: 600;
                                            cursor: pointer;
                                            transition: all 0.3s ease;
                                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                                            margin-top: 20px;
                                        }
                                        .back-button:hover {
                                            transform: translateY(-2px);
                                            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
                                        }
                                        @media (max-width: 768px) {
                                            .error-container { padding: 40px 20px; }
                                            .error-code { font-size: 80px; }
                                            h1 { font-size: 24px; }
                                            .error-message { font-size: 16px; }
                                        }
                                    </style>
                                </head>
                                <body>
                                    <div class="error-container">
                                        <div class="error-icon">‚ö†Ô∏è</div>
                                        <div class="error-code">500</div>
                                        <h1>Internal Server Error</h1>
                                        <p class="error-message">We're experiencing technical difficulties and our team has been automatically notified.</p>
                                        
                                        <div class="status-box">
                                            <span class="status-icon">üîß</span>
                                            We are working now on solving this issue
                                        </div>
                                        
                                        <div class="details">
                                            <h3>Technical Information</h3>
                                            <p><strong>Error Code:</strong> HTTP 500 Internal Server Error</p>
                                            <p><strong>Timestamp:</strong> <span class="timestamp">${new Date().toLocaleString()}</span></p>
                                            <p><strong>Request URL:</strong> ${window.location.href}</p>
                                            <p><strong>Incident ID:</strong> #${Math.random().toString(36).substr(2, 9).toUpperCase()}</p>
                                        </div>
                                        
                                        <p style="color: #7f8c8d; margin-bottom: 20px;">Please try again in a few minutes or contact support if the problem persists.</p>
                                        
                                        <button class="back-button" onclick="history.back()">‚Üê Go Back</button>
                                    </div>
                                </body>
                            </html>
                        `);
                        document.close();
                    } catch (e) {
                        console.error('[PagerDuty Simulator] Error creating 500 page:', e);
                        // Fallback - just replace the body content
                        document.body.innerHTML = `
                            <div style="
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                min-height: 100vh;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                margin: 0;
                                padding: 20px;
                                box-sizing: border-box;
                            ">
                                <div style="
                                    background: rgba(255, 255, 255, 0.95);
                                    backdrop-filter: blur(10px);
                                    border-radius: 20px;
                                    padding: 60px 40px;
                                    text-align: center;
                                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                                    max-width: 600px;
                                    width: 100%;
                                ">
                                    <div style="font-size: 80px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                                    <div style="font-size: 120px; font-weight: 800; color: #ff6b6b; margin-bottom: 10px; text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">500</div>
                                    <h1 style="font-size: 32px; color: #2c3e50; margin-bottom: 20px; font-weight: 600;">Internal Server Error</h1>
                                    <p style="font-size: 18px; color: #7f8c8d; margin-bottom: 30px;">We're experiencing technical difficulties and our team has been automatically notified.</p>
                                    <div style="
                                        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                                        color: white;
                                        padding: 20px;
                                        border-radius: 12px;
                                        margin: 30px 0;
                                        font-weight: 500;
                                        box-shadow: 0 8px 16px rgba(79, 172, 254, 0.3);
                                    ">
                                        <span style="font-size: 24px; margin-right: 10px;">üîß</span>
                                        We are working now on solving this issue
                                    </div>
                                    <p style="color: #7f8c8d; margin-bottom: 20px;">Please try again in a few minutes or contact support if the problem persists.</p>
                                    <p style="color: #95a5a6; font-size: 12px;">Incident ID: #${Math.random().toString(36).substr(2, 9).toUpperCase()} | ${new Date().toLocaleString()}</p>
                                    <button onclick="history.back()" style="
                                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                        color: white;
                                        border: none;
                                        padding: 15px 30px;
                                        border-radius: 25px;
                                        font-size: 16px;
                                        font-weight: 600;
                                        cursor: pointer;
                                        margin-top: 20px;
                                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                                    ">‚Üê Go Back</button>
                                </div>
                            </div>
                        `;
                    }
                } else if (allowFormContinuation) {
                    console.log('[PagerDuty Simulator] Allowing form continuation...');
                    // In a real scenario, this would continue with the original form submission
                    alert('Form would continue normally (simulation)');
                }
            }, delay);
        }

        // Add event listeners
        document.getElementById('testForm').addEventListener('submit', function(e) {
            handleElementIncident(e.target.querySelector('button[type="submit"]'), e);
        });

        document.getElementById('testButton').addEventListener('click', function(e) {
            handleElementIncident(e.target, e);
        });

        console.log('Test page loaded - ready for redirect testing');
    </script>
</body>
</html>