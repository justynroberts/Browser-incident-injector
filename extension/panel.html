<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="incident-injector-panel" class="incident-injector-panel" style="display: none;">
    <div class="panel-header">
        <div class="panel-title">
            <i class="fas fa-bolt"></i>
            <span>Incident Injector</span>
        </div>
        <button id="panel-close" class="panel-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="panel-content">
        <!-- Scenario Running Indicator -->
        <div id="scenario-running-indicator" class="scenario-indicator" style="display: none;">
            <div class="scenario-indicator-content">
                <i class="fas fa-exclamation-triangle scenario-icon"></i>
                <div class="scenario-info">
                    <span class="scenario-label">ðŸš¨ INCIDENT SIMULATION ACTIVE ðŸš¨</span>
                    <span id="scenario-name" class="scenario-name">Loading...</span>
                </div>
                <div class="scenario-progress">
                    <i class="fas fa-cog fa-spin"></i>
                </div>
            </div>
            <div class="scenario-progress-bar">
                <div id="scenario-progress-fill" class="progress-fill"></div>
            </div>
        </div>

        <div class="status-indicator">
            <span id="status-dot" class="status-dot"></span>
            <span id="status-text">Loading...</span>
        </div>

        <!-- Quick Actions with Scenarios -->
        <div class="section quick-actions-section">
            <div class="section-header">
                <h3><span class="section-icon"><i class="fas fa-rocket"></i></span> Quick Actions</h3>
            </div>
            <div class="section-content">
                <!-- Extension Toggle -->
                <div class="toggle-container" style="margin-bottom: 15px;">
                    <label class="toggle-label">
                        <input type="checkbox" id="extension-enabled" class="toggle-input">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Extension Enabled</span>
                    </label>
                </div>

                <!-- Scenario Selection -->
                <div class="form-group" style="margin-bottom: 12px;">
                    <label for="scenario-select">Scenario:</label>
                    <select id="scenario-select" class="select-input">
                        <option value="">-- Select a scenario --</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="button-row" style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button id="run-scenario-quick" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-play"></i> Run Scenario
                    </button>
                </div>

                <!-- Validation Messages -->
                <div id="quick-action-result" class="test-result"></div>
            </div>
        </div>

        <!-- Scenarios (Event Definitions) -->
        <div class="section">
            <div class="section-header">
                <h3><span class="section-icon"><i class="fas fa-play-circle"></i></span> Scenarios</h3>
                <button class="toggle-button collapsed" id="toggle-event-definition">
                    <span class="toggle-icon"><i class="fas fa-chevron-right"></i></span>
                </button>
            </div>
            <div class="section-content collapsed" id="event-definition-content">
                <div class="form-group">
                    <label for="event-definition">Event Definition JSON:</label>
                    <textarea
                        id="event-definition"
                        rows="5"
                        placeholder="Paste your PagerDuty event definition JSON here"
                    ></textarea>
                    <div class="input-help">
                        Define complex incident scenarios with timing and multiple event types
                    </div>
                    <div id="definition-validation" class="validation-message"></div>
                    <div class="button-row">
                        <button id="load-sample" class="btn btn-secondary">
                            <span class="btn-icon"><i class="fas fa-file-alt"></i></span>
                            Load Default
                        </button>
                        <button id="edit-json" class="btn btn-secondary">
                            <span class="btn-icon"><i class="fas fa-edit"></i></span>
                            Edit JSON
                        </button>
                    </div>
                    <div class="button-row" style="margin-top: 10px;">
                        <button id="save-to-file" class="btn btn-secondary">
                            <span class="btn-icon"><i class="fas fa-download"></i></span>
                            Save
                        </button>
                        <button id="load-from-file" class="btn btn-secondary">
                            <span class="btn-icon"><i class="fas fa-upload"></i></span>
                            Load
                        </button>
                    </div>
                </div>

                <div class="scenario-controls" id="scenario-controls" style="display: none;">
                    <!-- Scenario select moved to Quick Actions -->
                </div>
            </div>
        </div>

        <!-- Alert & Trigger Configuration (includes Crux) -->
        <div class="section">
            <div class="section-header">
                <h3><span class="section-icon"><i class="fas fa-bell"></i></span> Triggers & Alerts</h3>
                <button class="toggle-button collapsed" id="toggle-alert-config">
                    <span class="toggle-icon"><i class="fas fa-chevron-right"></i></span>
                </button>
            </div>
            <div class="section-content collapsed" id="alert-config-content">
                <div class="form-group">
                    <label for="alert-message">Custom Alert Message:</label>
                    <textarea
                        id="alert-message"
                        rows="2"
                        placeholder="Error: Something went wrong. Our team is on it."
                    ></textarea>
                </div>

                <div class="trigger-options-container">
                    <div class="trigger-option">
                        <span class="option-number">1</span>
                        <div class="option-content">
                            <div class="option-title">Show Custom Alert</div>
                            <div class="option-description">Display alert message when triggered</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="option-create-alert">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="trigger-option">
                        <span class="option-number">2</span>
                        <div class="option-content">
                            <div class="option-title">Run Scenario</div>
                            <div class="option-description">Execute selected scenario on trigger</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="option-run-scenario">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="trigger-option">
                        <span class="option-number">3</span>
                        <div class="option-content">
                            <div class="option-title">Show 500 Error Page</div>
                            <div class="option-description">Display server error page</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="option-add-500-error">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="trigger-option">
                        <span class="option-number">4</span>
                        <div class="option-content">
                            <div class="option-title">Trigger Crux Event</div>
                            <div class="option-description">Send request to Crux URL below</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="option-trigger-crux">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="trigger-option">
                        <span class="option-number">5</span>
                        <div class="option-content">
                            <div class="option-title">Continue to Destination</div>
                            <div class="option-description">Allow action to proceed after trigger</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="option-continue-destination">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Crux URL moved here -->
                <div class="form-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-subtle);">
                    <label for="crux-url">Crux Event URL:</label>
                    <input
                        type="text"
                        id="crux-url"
                        placeholder="https://eventsender.example.com/ondemand/your-id"
                        style="width: 100%; font-family: monospace; font-size: 11px; padding: 8px;"
                    >
                    <div class="input-help">
                        GET request sent here when Crux trigger is enabled
                    </div>
                </div>
            </div>
        </div>

        <!-- PagerDuty Configuration -->
        <div class="section">
            <div class="section-header">
                <h3><span class="section-icon"><i class="fas fa-cog"></i></span> PagerDuty Config</h3>
                <button class="toggle-button collapsed" id="toggle-pagerduty-config">
                    <span class="toggle-icon"><i class="fas fa-chevron-right"></i></span>
                </button>
            </div>
            <div class="section-content collapsed" id="pagerduty-config-content">
                <div class="form-group">
                    <label for="integration-key">Integration Key:</label>
                    <input
                        type="text"
                        id="integration-key"
                        placeholder="Enter your PagerDuty integration key"
                        maxlength="32"
                        style="width: 100%; font-family: monospace; font-size: 12px; padding: 8px;"
                    >
                    <div class="input-help">
                        32-character key from PagerDuty Events API v2
                    </div>
                    <div id="key-validation" class="validation-message"></div>
                </div>
            </div>
        </div>

        <!-- Trigger on Click -->
        <div class="section">
            <div class="section-header">
                <h3><span class="section-icon"><i class="fas fa-mouse-pointer"></i></span> Click Triggers</h3>
                <button class="toggle-button collapsed" id="toggle-target-config">
                    <span class="toggle-icon"><i class="fas fa-chevron-right"></i></span>
                </button>
            </div>
            <div class="section-content collapsed" id="target-config-content">
                <div class="trigger-option">
                    <span class="option-number">ðŸŽ¯</span>
                    <div class="option-content">
                        <div class="option-title">Enable Click Interception</div>
                        <div class="option-description">Intercept clicks on specific elements</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="trigger-on-click-enabled">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div id="click-interception-config" style="display: none; margin-top: 15px;">
                    <div class="form-group">
                        <label for="target-elements">Element Text to Match:</label>
                        <textarea
                            id="target-elements"
                            rows="2"
                            placeholder="sign in, checkout, submit, buy now"
                        ></textarea>
                        <div class="input-help">
                            Comma-separated button/link text to intercept (case-insensitive)
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="panel-footer">
            <div class="footer-links">
                <a href="#" id="help-link">Help</a>
                <a href="#" id="setup-link">Setup Guide</a>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Help & Setup Guide</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <h3>Setup Instructions:</h3>
                <ol>
                    <li>Log into your PagerDuty account</li>
                    <li>Go to Services â†’ Your Service â†’ Integrations</li>
                    <li>Add a new "Events API v2" integration</li>
                    <li>Copy the Integration Key (32 characters)</li>
                    <li>Paste it into the field above</li>
                    <li>Enable the extension and test it</li>
                </ol>

                <h3>How it works:</h3>
                <p>This extension intercepts form submissions on any website and creates PagerDuty incidents to inject realistic errors. It's useful for testing incident response procedures.</p>

                <h3>Features:</h3>
                <ul>
                    <li>Intercepts all form submissions</li>
                    <li>Shows customizable error alerts</li>
                    <li>Creates detailed PagerDuty incidents</li>
                    <li>Prevents duplicate incidents (5-minute window)</li>
                    <li>Works with AJAX and SPA forms</li>
                </ul>
            </div>
        </div>
    </div>
</div>

</body>
</html>
